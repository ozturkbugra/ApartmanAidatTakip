@if (Request.Cookies["KullaniciBilgileri"] == null || Request.Cookies["KullaniciBilgileri"]["KullaniciID"] == null)
{
    Response.Redirect("/Anasayfa/Login");
}

@{
    string kullaniciAdi = HttpUtility.UrlDecode(Request.Cookies["KullaniciBilgileri"]["KullaniciAdi"]);
    string adSoyad = HttpUtility.UrlDecode(Request.Cookies["KullaniciBilgileri"]["AdSoyad"]);
    string binaAdi = HttpUtility.UrlDecode(Request.Cookies["KullaniciBilgileri"]["BinaAdi"]);
    var aktif = Session["Aktif"] != null ? Session["Aktif"].ToString() : "";

    // Batarya Rengi Mantığı
    string pilClass = "battery-fill-green";
    string pilTextClass = "text-success";

    if (ViewBag.KalanGun < 30)
    {
        pilClass = "battery-fill-red";
        pilTextClass = "text-danger";
    }
    else if (ViewBag.KalanGun < 90)
    {
        pilClass = "battery-fill-orange";
        pilTextClass = "text-warning";
    }
}

<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>@ViewBag.Title - Apartman Aidat Yazılımı</title>

    <link href="/Content/Admin/assets/img/favicon.png" rel="icon">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/Content/Admin/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/Content/Admin/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="/Content/Admin/assets/vendor/simple-datatables/style.css" rel="stylesheet">
    <link href="/Content/Admin/assets/css/style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }

        /* --- Header --- */
        .header {
            background: #fff;
            box-shadow: 0 2px 15px rgba(0,0,0,0.03);
            height: 70px;
            z-index: 999;
        }

        .logo span {
            color: #4154f1;
            font-weight: 700;
            font-size: 22px;
            letter-spacing: 0.5px;
        }

        /* Arama Kutusu */
        .search-bar .search-form input {
            border: 1px solid #dee2e6;
            padding: 8px 15px 8px 40px;
            border-radius: 50px;
            width: 100%;
            transition: 0.3s;
            background: #f8f9fa;
            color: #495057;
        }

            .search-bar .search-form input:focus {
                background: #fff;
                border-color: #4154f1;
                box-shadow: 0 0 0 3px rgba(65, 84, 241, 0.1);
            }

        .search-bar .search-form button {
            border: 0;
            background: none;
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #4154f1;
        }

        /* --- Sidebar Modern --- */
        .sidebar {
            width: 280px;
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            padding-top: 20px;
            border-right: 1px solid #f1f3f5;
        }

        /* Başlıklar */
        .sidebar-nav .nav-heading {
            font-size: 11px;
            text-transform: uppercase;
            color: #adb5bd;
            font-weight: 700;
            margin: 15px 0 5px 15px;
            letter-spacing: 1px;
        }

        /* Ana Menü Linkleri */
        .sidebar-nav .nav-link {
            font-weight: 600;
            color: #444;
            background: transparent;
            margin-bottom: 5px;
            border-radius: 10px;
            padding: 10px 15px;
            transition: all 0.2s ease-in-out;
        }

            /* İkonlar (Kendi Rengiyle) */
            .sidebar-nav .nav-link i {
                font-size: 1.3rem; /* İkonlar büyütüldü */
                margin-right: 12px;
                transition: 0.3s;
                /* Arka plan kutusu yok, direkt renk */
            }

        /* İkon Özel Renkleri */
        .color-blue {
            color: #2563eb !important;
        }

        .color-purple {
            color: #7c3aed !important;
        }

        .color-green {
            color: #059669 !important;
        }

        .color-orange {
            color: #ea580c !important;
        }

        .color-cyan {
            color: #0891b2 !important;
        }

        .color-red {
            color: #dc2626 !important;
        }

        .color-yellow {
            color: #ca8a04 !important;
        }

        .color-dark {
            color: #334155 !important;
        }

        /* Hover & Active */
        .sidebar-nav .nav-link:hover {
            background: #f1f5f9;
            color: #2563eb;
            transform: translateX(3px);
        }

        /* Açık Menü (Toggle Açıkken) */
        .sidebar-nav .nav-link:not(.collapsed) {
            background: #eff6ff;
            color: #2563eb;
        }

        /* Alt Menü */
        .sidebar-nav .nav-content {
            padding-left: 10px;
            margin-left: 20px;
            border-left: 2px solid #f1f5f9;
        }

            .sidebar-nav .nav-content a {
                font-size: 0.9rem;
                color: #64748b;
                padding: 8px 10px;
                transition: 0.2s;
                display: flex;
                align-items: center;
                border-radius: 6px;
                margin-top: 2px;
            }

                .sidebar-nav .nav-content a i {
                    font-size: 1.1rem;
                    margin-right: 10px;
                    color: #94a3b8; /* Varsayılan alt ikon rengi */
                }

                .sidebar-nav .nav-content a:hover,
                .sidebar-nav .nav-content a.active {
                    color: #2563eb;
                    background: #fff;
                    font-weight: 500;
                }

                    .sidebar-nav .nav-content a:hover i,
                    .sidebar-nav .nav-content a.active i {
                        color: #2563eb; /* Aktif olunca mavi olsun */
                    }

        /* --- BATARYA (Telefon Bataryası) --- */
        .phone-battery-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #fff;
            padding: 6px 15px;
            border-radius: 50px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
        }

        .battery-shell {
            width: 40px;
            height: 18px;
            border: 2px solid #495057;
            border-radius: 4px;
            position: relative;
            padding: 2px;
            display: flex;
            align-items: center;
        }
            /* Uç Kısım */
            .battery-shell::after {
                content: '';
                position: absolute;
                right: -5px;
                top: 4px;
                width: 3px;
                height: 6px;
                background: #495057;
                border-radius: 0 2px 2px 0;
            }

        .battery-level {
            height: 100%;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }

            /* Şarj Animasyonu */
            .battery-level::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                bottom: 0;
                right: 0;
                background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0) 100%);
                transform: skewX(-20deg) translateX(-150%);
                animation: chargeShine 2.5s infinite;
            }

        @@keyframes chargeShine {
            0% {
                transform: skewX(-20deg) translateX(-150%);
            }

            100% {
                transform: skewX(-20deg) translateX(250%);
            }
        }

        .battery-fill-green {
            background: #10b981;
        }

        .battery-fill-orange {
            background: #f59e0b;
        }

        .battery-fill-red {
            background: #ef4444;
        }

        .battery-percent {
            font-size: 0.85rem;
            font-weight: 700;
            margin-right: 2px;
        }

        /* Duyuru */
        .duyuru-bar {
            background: linear-gradient(135deg, #4f46e5, #3b82f6);
            color: white;
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            margin-bottom: 25px;
            font-weight: 500;
        }
    </style>
</head>

<body>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function preventDotAndComma(event) {
            let key = event.key;
            if (/^[a-zA-ZğüşıöçĞÜŞİÖÇ]$/.test(key)) { event.preventDefault(); return; }
            if (/^[0-9]$/.test(key)) { return; }
            if ((key === '.' || key === ',')) {
                if (event.target.value.includes(',')) { event.preventDefault(); return; }
                event.preventDefault();
                let v = event.target.value;
                let p = event.target.selectionStart;
                event.target.value = v.slice(0, p) + ',' + v.slice(p);
                event.target.setSelectionRange(p + 1, p + 1);
                return;
            }
            if (key === 'Backspace' || key === 'Delete') { return; }
            event.preventDefault();
        }
    </script>

    <header id="header" class="header fixed-top d-flex align-items-center">
        <div class="d-flex align-items-center justify-content-between">
            <a href="/AnaSayfa" class="logo d-flex align-items-center">
                <img src="~/Content/Admin/assets/img/logo.png" alt="">
                <span class="d-none d-lg-block">Aidat Yazılımı</span>
            </a>
            <i class="bi bi-list toggle-sidebar-btn text-primary"></i>
        </div>

        <div class="search-bar">
            <form class="search-form d-flex align-items-center" onsubmit="return false;">
                <button type="button"><i class="bi bi-search"></i></button>
                <input type="text" id="menuSearch" placeholder="Modül veya sayfa ara..." title="Menüde ara">
            </form>
        </div>

        <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center">
                <li class="nav-item d-block d-lg-none">
                    <a class="nav-link nav-icon search-bar-toggle" href="#"><i class="bi bi-search"></i></a>
                </li>
                <li class="nav-item dropdown pe-3">
                    <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                        <img src="/Content/Admin/assets/img/profile-img.jpg" alt="Profile" class="rounded-circle border border-2 border-white shadow-sm">
                        <span class="d-none d-md-block dropdown-toggle ps-2 fw-bold text-dark">@kullaniciAdi</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile border-0 shadow-lg">
                        <li class="dropdown-header text-start">
                            <h6 class="text-primary mb-0">@adSoyad</h6>
                            <span class="small text-muted">@binaAdi</span>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item d-flex align-items-center" href="/AnaSayfa/Password"><i class="bi bi-shield-lock text-warning"></i><span>Şifre Değiştir</span></a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item d-flex align-items-center" href="/AnaSayfa/Logout"><i class="bi bi-box-arrow-right text-danger"></i><span>Çıkış Yap</span></a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <aside id="sidebar" class="sidebar">
        <ul class="sidebar-nav" id="sidebar-nav">

            <li class="nav-item">
                <a class="nav-link @(aktif == "Anasayfa" ? "" : "collapsed")" href="/AnaSayfa">
                    <i class="bi bi-grid-fill color-blue"></i>
                    <span>Ana Sayfa</span>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" id="link-yonetim" data-bs-target="#yonetim-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-building-gear color-purple"></i><span>Yönetim İşlemleri</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="yonetim-nav" class="nav-content collapse @(aktif == "AcilisBakiye" || aktif == "Sakinler" || aktif == "DaireBorclandir" || aktif == "PesinOdemeler" || aktif == "DonemEkle" ? "show" : "")">
                    <li><a href="/AnaSayfa/AcilisBakiye" class="@(aktif == "AcilisBakiye" ? "active" : "")"><i class="bi bi-safe2"></i><span>Açılış Bakiyesi</span></a></li>
                    <li><a href="/AnaSayfa/Sakinler" class="@(aktif == "Sakinler" ? "active" : "")"><i class="bi bi-people"></i><span>Daire Sakinleri</span></a></li>
                    <li><a href="/AnaSayfa/DaireBorclandir" class="@(aktif == "DaireBorclandir" ? "active" : "")"><i class="bi bi-cash-stack"></i><span>Daire Borçlandır</span></a></li>
                    <li><a href="/AnaSayfa/PesinOdemeler" class="@(aktif == "PesinOdemeler" ? "active" : "")"><i class="bi bi-wallet2"></i><span>Peşin Ödemeler</span></a></li>
                    <li><a href="/AnaSayfa/DonemEkle" class="@(aktif == "DonemEkle" ? "active" : "")"><i class="bi bi-calendar-plus"></i><span>Dönem Ekle</span></a></li>
                </ul>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" id="link-islemler" data-bs-target="#islemler-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-sliders color-green"></i><span>İşlemler</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="islemler-nav" class="nav-content collapse @(aktif == "TopluMakbuz" || aktif == "Makbuz" || aktif == "Giderler" || aktif == "Tahsilat" ? "show" : "")">
                    <li><a href="/TopluMakbuz" class="@(aktif == "TopluMakbuz" ? "active" : "")"><i class="bi bi-printer"></i><span>Toplu Makbuz</span></a></li>
                    <li><a href="/Makbuz" class="@(aktif == "Makbuz" ? "active" : "")"><i class="bi bi-receipt"></i><span>Makbuz Oluştur</span></a></li>
                    <li><a href="/AnaSayfa/Giderler" class="@(aktif == "Giderler" ? "active" : "")"><i class="bi bi-dash-circle"></i><span>Gider Girişi</span></a></li>
                    <li><a href="/AnaSayfa/Tahsilat" class="@(aktif == "Tahsilat" ? "active" : "")"><i class="bi bi-plus-circle"></i><span>Tahsilat Ekle</span></a></li>
                </ul>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" id="link-diger" data-bs-target="#diger-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-collection color-orange"></i><span>Diğer</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="diger-nav" class="nav-content collapse @(aktif == "EklenenAidatlar" || aktif == "EklenenEkler" || aktif == "Ara" || aktif == "DaireSorgu" || aktif == "Notlar" ? "show" : "")">
                    <li><a href="/AnaSayfa/EklenenAidatlar" class="@(aktif == "EklenenAidatlar" ? "active" : "")"><i class="bi bi-building-check"></i><span>Aidat Listesi</span></a></li>
                    <li><a href="/AnaSayfa/EklenenEkler" class="@(aktif == "EklenenEkler" ? "active" : "")"><i class="bi bi-layers"></i><span>Demirbaş Listesi</span></a></li>
                    <li><a href="/Makbuz/Ara" class="@(aktif == "Ara" ? "active" : "")"><i class="bi bi-search"></i><span>Makbuz Ara</span></a></li>
                    <li><a href="/AnaSayfa/DaireSorgu" class="@(aktif == "DaireSorgu" ? "active" : "")"><i class="bi bi-zoom-in"></i><span>Daire Sorgula</span></a></li>
                    <li><a href="/AnaSayfa/Notlar" class="@(aktif == "Notlar" ? "active" : "")"><i class="bi bi-journal-bookmark"></i><span>Notlarım</span></a></li>
                </ul>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" id="link-raporlar" data-bs-target="#raporlar-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-pie-chart-fill color-red"></i><span>Raporlar</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="raporlar-nav" class="nav-content collapse @(aktif == "BorcluDaireler" || aktif == "GelirGider" || aktif == "TureGoreGelirGider" || aktif == "DetayliGelirGider" || aktif == "DenetciRaporu" || aktif == "TureGoreGiderler" || aktif == "DevirBakiyeleri" ? "show" : "")">
                    <li><a href="/AnaSayfa/BorcluDaireler" class="@(aktif == "BorcluDaireler" ? "active" : "")"><i class="bi bi-person-exclamation"></i><span>Borçlu Daireler</span></a></li>
                    <li><a href="/Raporlar/GelirGider" class="@(aktif == "GelirGider" ? "active" : "")"><i class="bi bi-pie-chart"></i><span>Gelir Gider Raporu</span></a></li>
                    <li><a href="/Raporlar/TureGoreGelirGiderTarihBazli" class="@(aktif == "TureGoreGelirGider" ? "active" : "")"><i class="bi bi-bar-chart"></i><span>Türe Göre Gelir Giderler</span></a></li>
                    <li><a href="/Raporlar/DetayliGelirGider?yil=@DateTime.Now.Year&ay=@DateTime.Now.Month" class="@(aktif == "DetayliGelirGider" ? "active" : "")"><i class="bi bi-table"></i><span>Detaylı Gelir Gider Raporu</span></a></li>
                    <li><a href="/Raporlar/DenetciRaporu" class="@(aktif == "DenetciRaporu" ? "active" : "")"><i class="bi bi-clipboard-check"></i><span>Denetçi Raporu</span></a></li>
                    <li><a href="/Raporlar/TureGoreGiderler" class="@(aktif == "TureGoreGiderler" ? "active" : "")"><i class="bi bi-graph-down-arrow"></i><span>Kategori Bazlı Giderler</span></a></li>
                    <li><a href="/Raporlar/DevirBakiyeleri" class="@(aktif == "DevirBakiyeleri" ? "active" : "")"><i class="bi bi-arrow-repeat"></i><span>Devir Bakiyeleri</span></a></li>
                </ul>
            </li>

        </ul>
    </aside>

    <main id="main" class="main">

        @if (ViewBag.Duyurular != null && ViewBag.Duyurular.Count > 0)
        {
            <div class="duyuru-bar">
                <marquee behavior="scroll" direction="left" scrollamount="6">
                    @foreach (var item in ViewBag.Duyurular)
                    {
                        <span class="me-5">
                            <i class="bi bi-megaphone-fill me-2"></i> <b>@item.Baslik:</b> @item.Aciklama
                        </span>
                    }
                </marquee>
            </div>
        }

        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">

            <div class="text-muted d-flex align-items-center gap-3 small">
                <div class="d-flex align-items-center">
                    <i class="bi bi-building fs-6 me-2 text-primary"></i>
                    <span class="fw-bold text-dark">@binaAdi</span>
                </div>
                <span class="d-none d-md-block text-gray-300">|</span>
                <div class="d-flex align-items-center">
                    <i class="bi bi-clock-history fs-6 me-2 text-primary"></i>
                    <span>@ViewBag.LisansTarih</span>
                </div>
            </div>

            <div class="d-flex align-items-center gap-3">

                <div class="phone-battery-wrapper" title="Lisans Süresi">
                    <span class="battery-percent @pilTextClass">@ViewBag.Percent%</span>
                    <div class="battery-shell">
                        <div class="battery-level @pilClass" style="width: @ViewBag.Percent%"></div>
                    </div>
                    <span class="small text-muted ms-1 fw-bold">@ViewBag.KalanGun Gün</span>
                </div>

                <a href="https://www.youtube.com/watch?v=Z5XfSiqd6bA&t=5s" class="btn btn-warning btn-sm text-white shadow-sm d-flex align-items-center gap-2" target="_blank" style="border-radius: 50px; padding: 7px 15px;">
                    <i class="bi bi-play-circle-fill"></i> <span>Eğitim</span>
                </a>
            </div>
        </div>

        @RenderBody()
    </main>

    <footer id="footer" class="footer">
        <div class="copyright small text-muted">
            &copy; 2023 - @DateTime.Now.Year <strong><span><a href="https://bugraozturk.com.tr/">Buğra Öztürk</a></span></strong>. Tüm Hakları Saklıdır.
        </div>
    </footer>

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

    <script src="/Content/Admin/assets/vendor/apexcharts/apexcharts.min.js"></script>
    <script src="/Content/Admin/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/Content/Admin/assets/vendor/chart.js/chart.umd.js"></script>
    <script src="/Content/Admin/assets/vendor/echarts/echarts.min.js"></script>
    <script src="/Content/Admin/assets/vendor/quill/quill.min.js"></script>
    <script src="/Content/Admin/assets/vendor/simple-datatables/simple-datatables.js"></script>
    <script src="/Content/Admin/assets/vendor/tinymce/tinymce.min.js"></script>
    <script src="/Content/Admin/assets/vendor/php-email-form/validate.js"></script>
    <script src="/Content/Admin/assets/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

    <script>
        $(document).ready(function () {
            // Select2
            $('.filter').select2({
                width: '100%',
                allowClear: true,
                placeholder: "Seçim Yapınız"
            });

            // --- LOCAL STORAGE İLE MENÜ DURUMUNU HATIRLA ---

            // Sayfa yüklendiğinde hafızadaki menüleri aç
            var savedMenus = JSON.parse(localStorage.getItem('openMenus')) || [];

            // Eğer session'dan gelen aktif menü varsa, onu da listeye ekle (garanti olsun)
            var sessionActiveParent = $('.sidebar-nav .nav-content a.active').closest('.nav-content').attr('id');
            if (sessionActiveParent && !savedMenus.includes(sessionActiveParent)) {
                savedMenus.push(sessionActiveParent);
            }

            savedMenus.forEach(function (menuId) {
                var menu = $('#' + menuId);
                var link = $('[data-bs-target="#' + menuId + '"]');

                if (menu.length) {
                    menu.addClass('show');
                    link.removeClass('collapsed');
                    link.attr('aria-expanded', 'true');
                }
            });

            // Menü açıldığında ID'yi kaydet
            $('.sidebar-nav .nav-content').on('shown.bs.collapse', function () {
                var id = $(this).attr('id');
                var currentMenus = JSON.parse(localStorage.getItem('openMenus')) || [];
                if (!currentMenus.includes(id)) {
                    currentMenus.push(id);
                    localStorage.setItem('openMenus', JSON.stringify(currentMenus));
                }
            });

            // Menü kapandığında ID'yi sil
            $('.sidebar-nav .nav-content').on('hidden.bs.collapse', function () {
                var id = $(this).attr('id');
                var currentMenus = JSON.parse(localStorage.getItem('openMenus')) || [];
                var index = currentMenus.indexOf(id);
                if (index > -1) {
                    currentMenus.splice(index, 1);
                    localStorage.setItem('openMenus', JSON.stringify(currentMenus));
                }
            });

            // --- MODERN ARAMA ---
            function normalizeText(text) {
                return text.toLocaleLowerCase('tr-TR')
                    .replace(/ı/g, 'i').replace(/ş/g, 's')
                    .replace(/ğ/g, 'g').replace(/ü/g, 'u')
                    .replace(/ö/g, 'o').replace(/ç/g, 'c');
            }

            $('#menuSearch').on('keyup', function () {
                var searchText = normalizeText($(this).val());

                if (searchText === "") {
                    // Arama temizlenirse sadece hafızadakileri aç
                    $('.sidebar-nav .nav-content').collapse('hide');
                    savedMenus.forEach(function (menuId) {
                        $('#' + menuId).collapse('show');
                    });
                    $('.sidebar-nav .nav-content li').show();
                    $('.sidebar-nav .nav-item').show();
                    return;
                }

                // Alt linklerde ara
                $('.sidebar-nav .nav-content li').each(function () {
                    var itemText = normalizeText($(this).text());
                    var parentCollapse = $(this).closest('.nav-content');
                    var parentItem = parentCollapse.closest('.nav-item');

                    if (itemText.indexOf(searchText) !== -1) {
                        $(this).show();
                        parentCollapse.collapse('show');
                        parentItem.show();
                    } else {
                        $(this).hide();
                    }
                });

                // Başlıkları kontrol et
                $('.sidebar-nav .nav-item').each(function () {
                    var headerLink = $(this).find('.nav-link');
                    var headerText = normalizeText(headerLink.text());
                    var hasVisibleChildren = $(this).find('.nav-content li:visible').length > 0;

                    if (headerText.indexOf(searchText) !== -1 || hasVisibleChildren) {
                        $(this).show();
                        // Eğer başlık bulunduysa alt menüyü de aç
                        if (headerText.indexOf(searchText) !== -1) {
                            $(this).find('.nav-content').collapse('show');
                            $(this).find('.nav-content li').show();
                        }
                    } else {
                        $(this).hide();
                    }
                });
            });
        });
    </script>

</body>
</html>